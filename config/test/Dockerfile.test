FROM ghcr.io/astral-sh/uv:python3.12-bookworm-slim AS builder

WORKDIR /app
ENV PYTHONDONTWRITEBYTECODE=1 \
    UV_LINK_MODE=copy

# Copy metadata first (for caching)
COPY pyproject.toml alembic.ini ./
COPY src/ ./src/

RUN --mount=type=cache,target=/root/.cache/uv \
    uv pip install --system --no-compile ".[dev,test]"

COPY tests/ ./tests/